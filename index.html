<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>WebRTC Text Sync</title>
</head>
<body>
  <h2>WebRTC Text Sync</h2>
  <textarea id="textBox" rows="6" cols="40" placeholder="Type here..."></textarea>
  <pre id="log"></pre>

  <h3>Manual Signaling</h3>
  <textarea id="offer" placeholder="Offer"></textarea>
  <textarea id="answer" placeholder="Answer"></textarea>
  <button id="createOffer">Create Offer</button>
  <button id="createAnswer">Create Answer</button>
  <button id="setAnswer">Set Answer</button>

  <script>
    let pc = new RTCPeerConnection();
    let channel = pc.createDataChannel("textSync");

    const textBox = document.getElementById("textBox");
    const log = document.getElementById("log");

    channel.onmessage = (e) => {
      textBox.value = e.data;
    };

    textBox.addEventListener("input", () => {
      channel.send(textBox.value);
    });

    pc.onicecandidate = (e) => {
      if (e.candidate) return;
      log.textContent = JSON.stringify(pc.localDescription);
    };

    document.getElementById("createOffer").onclick = async () => {
      let offer = await pc.createOffer();
      await pc.setLocalDescription(offer);
    };

    document.getElementById("createAnswer").onclick = async () => {
      let offer = JSON.parse(document.getElementById("offer").value);
      await pc.setRemoteDescription(offer);
      let answer = await pc.createAnswer();
      await pc.setLocalDescription(answer);
    };

    document.getElementById("setAnswer").onclick = async () => {
      let answer = JSON.parse(document.getElementById("answer").value);
      await pc.setRemoteDescription(answer);
    };
  </script>
</body>
</html>
